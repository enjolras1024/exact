<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Exact</title>

  <link href="../stylesheets/codemirror.css" rel="stylesheet">
  <link href="../stylesheets/alice.css" rel="stylesheet">
  <link href="../stylesheets/defaults.css" rel="stylesheet">
  <!--<link href="../stylesheets/index.css" rel="stylesheet">-->


</head>
<body>
<header class="header">
  <nav class="nav-bar">
    <h3 class="brand"><a href="../" class="logo">Exact</a></h3>
    <a class="menu-btn"></a>
    <ul class="menu-bar">
      <li><a href="../examples/todomvc.html" class="menu-item"> Examples </a></li>
      <li><a href="#" class="menu-item  active"> Documents </a></li>
      <li><a href="#" class="menu-item"> Downloads </a></li>
      <li><a href="#" class="menu-item"> Blogs </a></li>
      <li><a href="#" class="menu-item"> GitHub </a></li>
    </ul>
  </nav>
</header>
<div class="main">
  <aside class="side-bar">
    <div class="card">
      <h4>Overview</h4>
      <ul class="list">
        <li><a href="./index.html#hello-world" class="link">Hello World</a></li>
        <li><a href="./index.html#class-diagram" class="link">Class Diagram</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Events</h4>
      <ul class="list">
        <li><a href="./events.html#on-off" class="link">On / Off</a></li>
        <li><a href="./events.html#send-emit" class="link">Send / Emit</a></li>
        <li><a href="./events.html#keys-of-event" class="link">Keys of Event</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Properties</h4>
      <ul class="list">
        <li><a href="./properties.html#setting-property" class="link">Setting Property</a></li>
        <li><a href="./properties.html#using-descriptors" class="link">Using Descriptors</a></li>
        <li><a href="./properties.html#adding-validation" class="link">Adding Validation</a></li>
        <li><a href="./properties.html#dirty-marking" class="link">Dirty Marking</a></li>
        <li><a href="./properties.html#property-changed-event" class="link">Property-Changed Event</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Models</h4>
      <ul class="list">
        <li><a href="./models.html#cache-or-store-for-object" class="link">Cache / Store for Object</a></li>
        <li><a href="./models.html#collection-for-array" class="link">Collection for Array</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Components</h4>
      <ul class="list">
        <li><a href="./shadow-skin-template.html" class="link">Shadow & Skin & Template</a></li>
        <li><a href="./components.html#using-template-strings-as-texts" class="link">Using Template Strings as Texts</a></li>
        <li><a href="./components.html#setting-attributes-of-elements" class="link">Setting Attributes of Elements</a></li>
        <li><a href="./components.html#syntax-of-events-style-class" class="link">Syntax of Events, Style, Class</a></li>
        <li><a href="./children-and-contents" class="link">Children and Contents</a></li>
        <li><a href="./lifecycle-and-hooks.html" class="link">Lifecycle and Hooks</a></li>
        <li><a href="./lists-and-itemadapters.html" class="link">Lists and ItemAdapters</a></li>
        <li><a href="./form-inputs.html" class="link">Form Inputs</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Bindings</h4>
      <ul class="list">
        <li><a href="./bindings.html#key-terms" class="link">Key Terms</a></li>
        <li><a href="./bindings.html#basic-syntax" class="link">Basic Syntax</a></li>
        <li><a href="./bindings.html#optional-converters" class="link">Optional Converters</a></li>
        <li><a href="./bindings.html#javascript-expressions" class="link">JavaScript Expressions</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Tips</h4>
      <ul class="list">
        <li><a href="./data-flow.html" class="link">Data Flow</a></li>
        <li><a href="./using-mixins.html" class="link">Using Mixins</a></li>
        <li><a href="./merging-descriptors.html" class="link">Merging Descriptors</a></li>
        <li><a href="./binding-instance-methods.html" class="link">Binding Instance Methods</a></li>
        <li><a href="./using-res-to-manage-resources.html" class="link">Using RES to Manage Resources</a></li>
        <li><a href="./using-objectutil-to-update-and-clone.html" class="link">Using ObjectUtil to Update or Clone</a></li>
      </ul>
    </div>
  </aside>
  <a class="side-btn">&gt;</a>
  <article class="article">
    <a id="on-off"></a>
    <h2>Bindings</h2>
    <p>
      Exact中的绑定是基于事件而实现的。这意味着，即便不使用绑定，你也能完成数据的传递。
      当然，使用绑定自有好处，它以简单直观的方式极大地简化了繁琐重复的赋值操作过程。
    </p>
    <div class="code-box">
      <script type="text/html" class="code-behind xml-mode"><input type="text" value="${ $.message }" readonly x-id="$msg"></script>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-measure">
              <pre>x</pre>
            </div>
            <div class="CodeMirror-measure"></div>
            <div style="position: relative; z-index: 1;"></div>
            <div class="CodeMirror-cursors">
              <div class="CodeMirror-cursor" style="left: 72.5625px; top: 0px; height: 17px;">&nbsp;</div>
            </div>
            <div class="CodeMirror-code">
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">&nbsp;&nbsp;<span
                          class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">input</span> <span
                          class="cm-attribute">type</span>=<span class="cm-string">"text"</span> <span
                          class="cm-attribute">value</span>=<span class="cm-string">"${ $.message }"</span> <span
                          class="cm-attribute">readonly</span> <span class="cm-attribute">x-id</span>=<span
                          class="cm-string">"$msg"</span><span class="cm-tag cm-bracket">&gt;</span></span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <a id="key-terms"></a>
    <p>几乎等价于：</p>
    <div class="code-box">
      <pre class="code-behind js-mode">
  this.on('changed.text', function() {
    this.$msg.set('value', this.message);
  });</pre>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-measure">
              <pre>x</pre>
            </div>
            <div class="CodeMirror-measure"></div>
            <div style="position: relative; z-index: 1;"></div>
            <div class="CodeMirror-cursors">
              <div class="CodeMirror-cursor" style="left: 32.9844px; top: 34px; height: 17px;">&nbsp;</div>
            </div>
            <div class="CodeMirror-code">
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                          class="cm-keyword">this</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed.text'</span>, <span
                          class="cm-keyword">function</span>() {</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">this</span>.<span
                          class="cm-property">$msg</span>.<span class="cm-property">set</span>(<span class="cm-string">'value'</span>, <span
                          class="cm-keyword">this</span>.<span class="cm-property">message</span>);</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  });</span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <h4 >Key Terms</h4>
    <p>使用好绑定，需要了解几个关键词。</p>
    <p>（1）绑定模式：基本上有3种绑定模式可选，即单次、单向和双向。其中单次绑定是单向绑定中特殊的一种绑定，它只在绑定建立时立即起效，不关心之后的变化。</p>
    <p>（2）绑定对象和绑定对象属性：绑定的目的是要将绑定表达式的运算结果赋给一个对象的属性。
      对于单次或单向绑定，这样的对象是任意的，这样的对象属性也是任意的。
      对于双向绑定，则要求绑定对象亦可作为绑定源，绑定对象属性亦可作为绑定源属性。</p>
    <p>（3）绑定源和绑定源属性：绑定源是数据的直接提供者。绑定源属性的值改变后通常会派发一个属性更改事件，但有时普通属性也可作为绑定源属性，参见（5）。</p>
    <p>（4）绑定域和绑定路径：绑定表达式依托的上下文就是绑定域，上下文中的属性链即可作为绑定路径。
      通常这样的上下文会是component、store或其他可派发属性更改事件的对象。如果绑定路径的长度为1，那实际上绑定域即为绑定源，绑定路径即为绑定源属性；
      否则，需要沿着绑定路径查找到绑定源和绑定源属性。</p>
    <a id="basic-syntax"></a>
    <p>（5）绑定域事件：没有特别声明的情况下，一个绑定会关心每个绑定路径对应的属性更改事件。但是，你也可以指定一个绑定域上的事件作为绑定域事件。
      这样，绑定就只关心指定绑定域事件有没有发生，而无需关心多个属性更改事件。</p>
    <p>（6）求值器和转换器：每个绑定都有一个求值器，负责根据一些常量和绑定域上一个或多个绑定路径来求出结果值。
      转换器是可选和多选的，负责将求值器求得的值转换成其他形式。</p>
    <h4>Basic Syntax</h4>
    <p>模板中绑定的语法是由Exact的HTMX解析器规定的，可以有不同的实现。默认的基本语法如下：</p>
    <a id="optional-converters"></a>
    <div class="code-box">
      <pre class="code-behind js-mode">
  // &lt;绑定对象属性名&gt;="&lt;绑定模式符&gt;{&lt;求值器表达式&gt; [|转换器表达式] [@绑定域事件]}"
  // 求值器表达式可以是单个绑定路径或一段JavaScript表达式
  // 转换器表达式的参数列表中可包含绑定路径或JavaScript表达式
  value="&{ $.text }"                                   // 单次绑定，单个路径
  value="${ $.text | upper }"                           // 单向绑定，单个路径，无参转换器
  value="${ $.time | format('HH:MM:SS', $.use24) }"     // 单向绑定，多个路径，带参数的转换器
  value="${ $.getFullName($.firstName, $.lastName) }"   // 单向绑定，多个路径，绑定域上的函数
  value="${ $.firstName + ' ' + $.lastName @changed }"  // 单向绑定，多个路径，事件为changed
  value="#{ $.color | hex2rgb }"                        // 双向绑定，双向转换器，必须是单个路径</pre>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-measure">
              <div class="CodeMirror-linenumber CodeMirror-gutter-elt">
                <div>9</div>
              </div>
            </div>
            <div class="CodeMirror-measure"></div>
            <div style="position: relative; z-index: 1;"></div>
            <div class="CodeMirror-cursors">
              <div class="CodeMirror-cursor" style="left: 201px; top: 34px; height: 17px;">&nbsp;</div>
            </div>
            <div class="CodeMirror-code">
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// &lt;绑定对象属性名&gt;="&lt;绑定模式符&gt;{&lt;求值器表达式&gt; [|转换器表达式] [@绑定域事件]}"</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 求值器表达式可以是单个绑定路径或一段JavaScript表达式</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 转换器表达式的参数列表中可包含绑定路径或JavaScript表达式</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"&amp;{ $.text }"</span>                                   <span
                          class="cm-comment">// 单次绑定，单个路径</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"${ $.text | upper }"</span>                           <span
                          class="cm-comment">// 单向绑定，单个路径，无参转换器</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"${ $.time | format('HH:MM:SS', $.use24) }"</span>     <span
                          class="cm-comment">// 单向绑定，多个路径，带参数的转换器</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"${ $.getFullName($.firstName, $.lastName) }"</span>   <span
                          class="cm-comment">// 单向绑定，多个路径，绑定域上的函数</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"${ $.firstName + ' ' + $.lastName @changed }"</span>  <span
                          class="cm-comment">// 单向绑定，多个路径，事件为changed</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">value</span><span
                          class="cm-operator">=</span><span class="cm-string">"#{ $.color | hex2rgb }"</span>                        <span
                          class="cm-comment">// 双向绑定，双向转换器，必须是单个路径</span></span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <p>单次绑定在语法上不需要支持绑定域事件，其他与单向绑定相同。对于双向绑定，则特别要求求值器表达式为单个绑定域路径，以保持对称关系。
      若在双向绑定使用转换器，转换器也必须是双向的，可参见下文。</p>
    <h4>Optional Converters</h4>
    <p>一些场景下，在视图上呈现数据时需要有一个格式化的过程，比如标题要大写：</p>
    <div class="code-box">
      <pre class="code-behind js-mode">
  {
    descriptors: ['title'],
    resources: {
      Header: Header, //已定义的Header组件类
      format: function(value, brackets) {
       return brackets[0] + value.toUpperCase() + brackets[1];
      }
    },
    $template: '&lt;header text="${$.title | format(\'##\')}" x-id="header" x-type="&{Header}"&gt;&lt;/header&gt;...'
  }
  // this.title = 'hello' => this.header.text = '#HELLO#'</pre>
<div class="CodeMirror cm-s-alice">
      <div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>11</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 19.7813px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">descriptors</span>: [<span class="cm-string">'title'</span>],</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">resources</span>: {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">Header</span>: <span class="cm-variable">Header</span>, <span class="cm-comment">//已定义的Header组件类</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-variable">format</span>: <span class="cm-keyword">function</span>(<span class="cm-def">value</span>, <span class="cm-def">brackets</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">       <span class="cm-keyword">return</span> <span class="cm-variable-2">brackets</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-variable-2">value</span>.<span class="cm-property">toUpperCase</span>() <span class="cm-operator">+</span> <span class="cm-variable-2">brackets</span>[<span class="cm-number">1</span>];</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    },</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">$template</span>: <span class="cm-string">'&lt;header text="${$.title | format(\'##\')}" x-id="header" x-type="&amp;{Header}"&gt;&lt;/header&gt;...'</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// this.title = 'hello' =&gt; this.header.text = '#HELLO#'</span></span></pre></div></div></div></div>
     </div>
    </div>
    <p>等价地，</p>
    <div class="code-box">
      <pre class="code-behind js-mode">
  var format = function(value, brackets) {
     return brackets[0] + value.toUpperCase() + brackets[1];
  }
  var args = ['title'];
  args.flags = [1]; // flag： 0=>常量（默认），1=>路径，2=>求值器

  Exact.Binding.build(this.header, 'title', this, {
    mode: 1,
    scopePaths: ['title'],
    evaluator: Exact.Evaluator.makeGetEvaluator(args),
    converters: [Exact.Evaluator.makeEvaluator(format, ["##"])]
  })</pre>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">format</span> <span class="cm-operator">=</span> <span class="cm-keyword">function</span>(<span class="cm-def">value</span>, <span class="cm-def">brackets</span>) {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">     <span class="cm-keyword">return</span> <span class="cm-variable-2">brackets</span>[<span class="cm-number">0</span>] <span class="cm-operator">+</span> <span class="cm-variable-2">value</span>.<span class="cm-property">toUpperCase</span>() <span class="cm-operator">+</span> <span class="cm-variable-2">brackets</span>[<span class="cm-number">1</span>];</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-keyword">var</span> <span class="cm-def">args</span> <span class="cm-operator">=</span> [<span class="cm-string">'title'</span>];</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">args</span>.<span class="cm-property">flags</span> <span class="cm-operator">=</span> [<span class="cm-number">1</span>]; <span class="cm-comment">// flag： 0=&gt;常量（默认），1=&gt;路径，2=&gt;求值器</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">Exact</span>.<span class="cm-property">Binding</span>.<span class="cm-property">build</span>(<span class="cm-keyword">this</span>.<span class="cm-property">header</span>, <span class="cm-string">'title'</span>, <span class="cm-keyword">this</span>, {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">mode</span>: <span class="cm-number">1</span>,</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">scopePaths</span>: [<span class="cm-string">'title'</span>],</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">evaluator</span>: <span class="cm-variable">Exact</span>.<span class="cm-property">Evaluator</span>.<span class="cm-property">makeGetEvaluator</span>(<span class="cm-variable">args</span>),</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">converters</span>: [<span class="cm-variable">Exact</span>.<span class="cm-property">Evaluator</span>.<span class="cm-property">makeEvaluator</span>(<span class="cm-variable">format</span>, [<span class="cm-string">"##"</span>])]</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  })</span></pre></div></div></div></div>
      </div>
    </div>
    <p>可见转换器本质上也是求值器，只是它接受的第一个参数为已求得的值。可以使用多个转换器（建议不超过2个），在声明式绑定表达式中以符号'|'连接。
    更多示例如下：</p>
    <a id="javascript-expressions"></a>
    <div class="code-box">
      <pre class="code-behind js-mode">
  // 本地resources或全局RES中定义了函数（或转换器对象）upper，没有额外参数；
  // 绑定域上定义了函数（或转换器对象）wrapIn，额外参数为常量。
  ${$.title | upper | $.wrapIn('##')}

  // 转换器中可以使用路径，当title、brackets或upperOrNot改变时都有可能触发绑定
  ${$.title | $.format($.upperOrNot, $.brackets)}
  // 等价于
  ${$.format($.title, $.upperOrNot, $.brackets)}

  // 双向转换器
  Exact.RES.register('num2str', {
    exec: String, //正向
    back: Number  //反向
  };
  #{$.price | num2str} </pre>
  <div class="CodeMirror cm-s-alice"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><div class="CodeMirror-linenumber CodeMirror-gutter-elt"><div>15</div></div></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"><div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 17px;">&nbsp;</div></div><div class="CodeMirror-code"><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 本地resources或全局RES中定义了函数（或转换器对象）upper，没有额外参数；</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 绑定域上定义了函数（或转换器对象）wrapIn，额外参数为常量。</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">$</span>{<span class="cm-variable">$</span>.<span class="cm-property">title</span> <span class="cm-operator">|</span> <span class="cm-variable">upper</span> <span class="cm-operator">|</span> <span class="cm-variable">$</span>.<span class="cm-property">wrapIn</span>(<span class="cm-string">'##'</span>)}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 转换器中可以使用路径，当title、brackets或upperOrNot改变时都有可能触发绑定</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">$</span>{<span class="cm-variable">$</span>.<span class="cm-property">title</span> <span class="cm-operator">|</span> <span class="cm-variable">$</span>.<span class="cm-property">format</span>(<span class="cm-variable">$</span>.<span class="cm-property">upperOrNot</span>, <span class="cm-variable">$</span>.<span class="cm-property">brackets</span>)}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">7</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 等价于</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">8</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">$</span>{<span class="cm-variable">$</span>.<span class="cm-property">format</span>(<span class="cm-variable">$</span>.<span class="cm-property">title</span>, <span class="cm-variable">$</span>.<span class="cm-property">upperOrNot</span>, <span class="cm-variable">$</span>.<span class="cm-property">brackets</span>)}</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">9</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">10</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 双向转换器</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">11</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">Exact</span>.<span class="cm-property">RES</span>.<span class="cm-property">register</span>(<span class="cm-string">'num2str'</span>, {</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">12</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">exec</span>: <span class="cm-variable">String</span>, <span class="cm-comment">//正向</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">13</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">back</span>: <span class="cm-variable">Number</span>  <span class="cm-comment">//反向</span></span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">14</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  };</span></pre></div><div style="position: relative;"><div class="CodeMirror-gutter-wrapper" style="left: -31px;"><div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">15</div></div><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-error">#{$.price | num2str} </span></span></pre></div></div></div></div></div>
      
    </div>
    <h4>JavaScript Expressions</h4>
    <p>声明式定义绑定表达式时，除了直接书写单个的绑定路径外，你还可以在其中书写简单的JavaScript表达式，例如：</p>
    <div class="code-box">
      <pre class="code-behind js-mode">
  ${ $.state === 'ok' }
  ${ $.firstName + ' ' + $.lastName }
  ${ $.amount > 100 ? 'large' : 'normal' }</pre>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-measure">
              <div class="CodeMirror-linenumber CodeMirror-gutter-elt">
                <div>3</div>
              </div>
            </div>
            <div class="CodeMirror-measure"></div>
            <div style="position: relative; z-index: 1;"></div>
            <div class="CodeMirror-cursors">
              <div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 17px;">&nbsp;</div>
            </div>
            <div class="CodeMirror-code">
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                          class="cm-variable">$</span>{ <span class="cm-variable">$</span>.<span class="cm-property">state</span> <span
                          class="cm-operator">===</span> <span class="cm-string">'ok'</span> }</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                          class="cm-variable">$</span>{ <span class="cm-variable">$</span>.<span class="cm-property">firstName</span> <span
                          class="cm-operator">+</span> <span class="cm-string">' '</span> <span
                          class="cm-operator">+</span> <span class="cm-variable">$</span>.<span class="cm-property">lastName</span> }</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                          class="cm-variable">$</span>{ <span class="cm-variable">$</span>.<span class="cm-property">amount</span> <span
                          class="cm-operator">&gt;</span> <span class="cm-number">100</span> <span
                          class="cm-operator">?</span> <span class="cm-string">'large'</span> : <span class="cm-string">'normal'</span> }</span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <p>对于上述含有运算符的表达式，Exact使用new Function(...)将JavaScript表达式转化成函数，因而无法访问绑定域以外的用户自定义变量，
      并存在一定的安全问题。所以我们建议在声明式定义的绑定表达式中尽量使用资源中定义过的函数或绑定域内的函数。</p>
    <div class="code-box">
      <pre class="code-behind js-mode">
  {
    resources: {
      equal: function(a, b) { return a === b; }
    },
    $template: '&lt;a x-class="active: ${equal($.state, \'ok\')}; stay: ${$.check($.state)}"&gt;&lt;/a&gt;'
  }</pre>
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-measure">
              <div class="CodeMirror-linenumber CodeMirror-gutter-elt">
                <div>6</div>
              </div>
            </div>
            <div class="CodeMirror-measure"></div>
            <div style="position: relative; z-index: 1;"></div>
            <div class="CodeMirror-cursors">
              <div class="CodeMirror-cursor" style="left: 0px; top: 0px; height: 17px;">&nbsp;</div>
            </div>
            <div class="CodeMirror-code">
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">1</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  {</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">2</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">resources</span>: {</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">3</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span
                          class="cm-variable">equal</span>: <span class="cm-keyword">function</span>(<span
                          class="cm-def">a</span>, <span class="cm-def">b</span>) { <span
                          class="cm-keyword">return</span> <span class="cm-variable-2">a</span> <span
                          class="cm-operator">===</span> <span class="cm-variable-2">b</span>; }</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">4</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    },</span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">5</div>
                </div>
                      <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">$template</span>: <span
                          class="cm-string">'&lt;a x-class="active: ${equal($.state, \'ok\')}; stay: ${$.check($.state)}"&gt;&lt;/a&gt;'</span></span></pre>
              </div>
              <div style="position: relative;">
                <div class="CodeMirror-gutter-wrapper" style="left: -31px;">
                  <div class="CodeMirror-linenumber CodeMirror-gutter-elt" style="left: 0px; width: 21px;">6</div>
                </div>
                <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  </article>
</div>
<!--<footer class="footer">
  <p>Released under the MIT license<br>
    © 2015 Chen Junyong. All rights reserved.</p>
</footer>-->

<script src="../javascripts/codemirror.js"></script>
<script src="../javascripts/javascript-mode.js"></script>
<!--<script src="../javascripts/xml-mode.js"></script>-->
<!--<script src="../javascripts/code-format.js"></script>-->
<script src="../javascripts/menu.js"></script>
</body>
</html>