<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Exact</title>

  <link href="../stylesheets/codemirror.css" rel="stylesheet">
  <link href="../stylesheets/alice.css" rel="stylesheet">
  <link href="../stylesheets/defaults.css" rel="stylesheet">
  <!--<link href="../stylesheets/index.css" rel="stylesheet">-->


</head>
<body>
<header class="header">
  <nav class="nav-bar">
    <h3 class="brand"><a href="../" class="logo">Exact</a></h3>
    <a class="menu-btn"></a>
    <ul class="menu-bar">
      <li><a href="../examples/color-palette.html" class="menu-item"> Examples </a></li>
      <li><a href="../downloads/index.html" class="menu-item"> Downloads </a></li>
      <li><a href="#" class="menu-item  active"> Documents </a></li>
      <li><a href="../apis/index.html" class="menu-item"> APIs </a></li>
      <li><a href="#" class="menu-item"> GitHub </a></li>
    </ul>
  </nav>
</header>
<div class="main">
  <aside class="side-bar">
    <div class="card">
      <h4>Overview</h4>
      <ul class="list">
        <li><a href="./index.html#setup" class="link">Setup</a></li>
        <li><a href="./index.html#hello-world" class="link">Hello World</a></li>
        <!--<li><a href="./index.html#class-diagram" class="link">Class Diagram</a></li>-->
      </ul>
    </div>
    <div class="card">
      <h4>Events</h4>
      <ul class="list">
        <li><a href="./events.html#on-off-once" class="link">On / Off / Once</a></li>
        <li><a href="./events.html#send-emit" class="link">Send / Emit</a></li>
        <li><a href="./events.html#key-name-of-event" class="link">Key Name of Event</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Properties</h4>
      <ul class="list">
        <li><a href="./properties.html#setting-property" class="link">Setting Property</a></li>
        <li><a href="./properties.html#dirty-marking" class="link">Dirty Marking</a></li>
        <li><a href="./properties.html#property-changed-event" class="link">Property-Changed Event</a></li>
        <li><a href="./properties.html#using-descriptors" class="link">Using Descriptors</a></li>
        <li><a href="./properties.html#adding-validation" class="link">Adding Validation</a></li>
        <li><a href="./properties.html#custom-getter-setter" class="link">Custom Getter / Setter</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Models</h4>
      <ul class="list">
        <li><a href="./models.html#cache-or-store-for-object" class="link">Cache / Store for Object</a></li>
        <li><a href="./models.html#collection-for-array" class="link">Collection for Array</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Components</h4>
      <ul class="list">
        <li><a href="./shadow-skin-template.html" class="link">Shadow & Skin & Template</a></li>
        <li><a href="./components.html#using-template-strings-as-texts" class="link">Using Template Strings as Texts</a></li>
        <li><a href="./components.html#setting-attributes-of-elements" class="link">Setting Attributes of Elements</a></li>
        <li><a href="./components.html#syntax-of-events-style-class" class="link">Syntax of Events, Style, Class</a></li>
        <li><a href="./children-and-contents" class="link">Children and Contents</a></li>
        <li><a href="./lifecycle-and-hooks.html" class="link">Lifecycle and Hooks</a></li>
        <li><a href="./lists-and-itemadapters.html" class="link">Lists and ItemAdapters</a></li>
        <li><a href="./form-inputs.html" class="link">Form Inputs</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Bindings</h4>
      <ul class="list">
        <li><a href="./bindings.html#key-terms" class="link">Key Terms</a></li>
        <li><a href="./bindings.html#basic-syntax" class="link">Basic Syntax</a></li>
        <li><a href="./bindings.html#optional-converters" class="link">Optional Converters</a></li>
        <li><a href="./bindings.html#javascript-expressions" class="link">JavaScript Expressions</a></li>
      </ul>
    </div>
    <div class="card">
      <h4>Tips</h4>
      <ul class="list">
        <li><a href="./data-flow.html" class="link">Data Flow</a></li>
        <li><a href="./using-mixins.html" class="link">Using Mixins</a></li>
        <li><a href="./merging-descriptors.html" class="link">Merging Descriptors</a></li>
        <li><a href="./binding-instance-methods.html" class="link">Binding Instance Methods</a></li>
        <li><a href="./using-res-to-manage-resources.html" class="link">Using RES to Manage Resources</a></li>
        <li><a href="./using-objectutil-to-update-and-clone.html" class="link">Using ObjectUtil to Update or Clone</a></li>
      </ul>
    </div>
  </aside>
  <a class="side-btn">&gt;</a>
  <article class="article">
    <a id="setting-property"></a>
    <h2>Properties</h2>
    <p>Exact使用定制的、渐进增强的`set`方法，在设置属性值的前后，为一些类的对象属性提供验证、脏标记或更改通知的功能实现。
      当然，我们也可以使用ES5中的Object.defineProperty定义某个属性的setter，并在setter方法中自定义所需的功能。
    </p>
    <h4 >Setting Property</h4>
    <p>用实例方法`set`来设置一个属性，用实例方法`save`来设置多个属性。
      在设置属性值的前后，可能会触发验证、脏标记或更改通知，这是在类的静态方法`set`中具体实现的。在继承或混入时，该静态方法可被扩展甚至重写。
      例如，Component是对Element的增强，Element.set方法中只实现了脏标记的功能，而Component.set方法中增加了属性验证和更改通知的功能。
      </p>

    <a id="dirty-marking"></a>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
  element.set('active', false);
  element.set('title', 'nothing');
  element.set({
    active: true,     // `active`被标记为脏，但不会send('changed.active')
    title: 'nothing'  // `title`没有脏，也不会send('changed.title')
  });

  // 假设没有为component的属性`active`添加验证
  component.set('active', false);
  component.set('title', 'nothing');
  component.set({
    active: true,     // `active`被标记为脏，会send('changed.active')
    title: 'nothing'  // `title`没有脏，不会send('changed.title')
  });</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code">
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">element</span>.<span class="cm-property">set</span>(<span class="cm-string">'active'</span>, <span
                  class="cm-atom">false</span>);</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">element</span>.<span class="cm-property">set</span>(<span class="cm-string">'title'</span>, <span
                  class="cm-string">'nothing'</span>);</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">element</span>.<span class="cm-property">save</span>({</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                  class="cm-property">active</span>: <span class="cm-atom">true</span>,     <span class="cm-comment">// `active`被标记为脏，但不会派发`changed.active`事件</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                  class="cm-property">title</span>: <span class="cm-string">'nothing'</span>  <span class="cm-comment">// `title`没有脏，也不会派发`changed.title`事件</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// 假设没有为component的属性`active`添加验证</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">component</span>.<span class="cm-property">set</span>(<span class="cm-string">'active'</span>, <span
                  class="cm-atom">false</span>);</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">component</span>.<span class="cm-property">set</span>(<span class="cm-string">'title'</span>, <span
                  class="cm-string">'nothing'</span>);</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span
                  class="cm-variable">component</span>.<span class="cm-property">save</span>({</span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                  class="cm-property">active</span>: <span class="cm-atom">true</span>,     <span class="cm-comment">// `active`被标记为脏，会派发`changed.active`事件</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span
                  class="cm-property">title</span>: <span class="cm-string">'nothing'</span>  <span class="cm-comment">// `title`没有脏，不会派发`changed.title`事件</span></span></pre>
              <pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre>
            </div>
          </div>
        </div>
      </div>
    </div>

    <h4>Dirty Marking</h4>
    <p>脏标记是与Shadow层的异步批量渲染有关的，在Shadow及其子类，以及Cache的`set`方法中被用到。它的目的是为了标记一下当前哪个属性发生了变化，以便于下一刻Shadow层将脏了的属性的新值渲染到DOM层。
      一次完整的事件循环中，一个属性可能发生了一次或多次改变，并可能变回为原来的值。Shadow层关心的是即将进行下一批渲染时，真正发生改变的有哪些属性。</p>
    <a id="property-changed-event"></a>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
// 假设element的`title`的原值为null
element.set('title', 'fine')
console.log(element.hasDirty('title')); // 输出：true
element.set('title', null)
console.log(element.hasDirty('title')); // 输出：false</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// 假设element的`title`的原值为null</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">element</span>.<span class="cm-property">set</span>(<span class="cm-string">'title'</span>, <span class="cm-string">'fine'</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">element</span>.<span class="cm-property">hasDirty</span>(<span class="cm-string">'title'</span>)); <span class="cm-comment">// 输出：true</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">element</span>.<span class="cm-property">set</span>(<span class="cm-string">'title'</span>, <span class="cm-atom">null</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">element</span>.<span class="cm-property">hasDirty</span>(<span class="cm-string">'title'</span>)); <span class="cm-comment">// 输出：false</span></span></pre></div>
          </div>
        </div>
      </div>
    </div>


    <h4>Property-Changed Event</h4>
    <p>当Component对象或Store对象的某个属性发生变化时，可能会派发这个属性改变的事件。数据的动态绑定要求绑定源属性的变化是可以探测到的，属性改变的事件正好满足了这个条件。
    我们可以将Component对象或Store对象的某个属性绑定到Element对象上，反之则起不到动态绑定的作用（但至少会完成一次赋值）。
    当数据绑定无法满足需求时，我们可以直接监听属性改变的事件，实现一些略复杂的逻辑。</p>
    <a id="using-descriptors"></a>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
store.on('changed', function(event) {
  // 监听所有属性的变化
});
store.on('changed.title', function(event) {
  // 只监听`title`属性的变化
});</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">store</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">event</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 监听所有属性的变化</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">store</span>.<span class="cm-property">on</span>(<span class="cm-string">'changed.title'</span>, <span class="cm-keyword">function</span>(<span class="cm-def">event</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 只监听`title`属性的变化</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre></div>
          </div>
        </div>
      </div>
    </div>

    <h4>Using Descriptors</h4>
    <p>在Exact内部，当`set`方法可用时，总是使用`set`方法来设置属性值。同时，Exact不妨碍我们使用ES5中的setter来实现`set`方法相同的功能，更为此提供了便捷的实现方式。
      只要在类的静态属性`descriptors`中声明一些属性名，Exact就会在首次初始化时使用Object.defineProperty方法（如果该方法可用）为这些属性定义一对getter/setter，
      使我们在用点语法为属性赋值时，亦能触发脏标记等行为。这是因为，所定义的setter和实例方法`set`都转而调用共同的类的静态方法`set`。例如：</p>

    <div class="code-box scroll">
      <!--<pre class="code-behind">
var SubComponent = Exact.defineClass({
  // 默认构造函数会调用父类构造函数
  // constructor: function() {
  //   Exact.Component.call(this);
  // },
  extend: Exact.Component,
  statics: {
    descriptors: [
      'title',
      'active'
    ]
  }
});

var subComponent = new SubComponent();
subComponent.title = 'abc'; // 等效于subComponent.set('title', 'abc');
subComponent.active = true; // 等效于subComponent.set('active', true);
subComponent.undeclared = true; // 与subComponent.set('undeclared', true)就有差别了</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">SubComponent</span> <span class="cm-operator">=</span> <span class="cm-variable">Exact</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 默认构造函数会调用父类构造函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// constructor: function() {</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">//   Exact.Component.call(this);</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// },</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">extend</span>: <span class="cm-variable">Exact</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">descriptors</span>: [<span class="cm-string">'title'</span>, <span class="cm-string">'active'</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable"><span class="cm-invalidchar" title="\u200b" aria-label="\u200b" cm-text="​">•</span></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">subComponent</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SubComponent</span>();</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subComponent</span>.<span class="cm-property">title</span> <span class="cm-operator">=</span> <span class="cm-string">'abc'</span>;     <span class="cm-comment">// 等效于subComponent.set('title', 'abc');</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subComponent</span>.<span class="cm-property">active</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>;     <span class="cm-comment">// 等效于subComponent.set('active', true);</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subComponent</span>.<span class="cm-property">undeclared</span> <span class="cm-operator">=</span> <span class="cm-atom">true</span>; <span class="cm-comment">// 不同于subComponent.set('undeclared', true)</span></span></pre></div>
          </div>
        </div>
      </div>
    </div>
    <p>这里使用了Exact的工具方法defineClass，但并没有使用什么魔法。你依然可以用你喜欢的方式定义一个类，例如使用ES6的语法糖。
      重要的是，在子类构造函数中调用了父类的构造函数。</p>
    <a id="adding-validation"></a>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
// 在ES6中
class SubComponent extends Exact.Component {
  // 默认构造函数会调用父类构造函数
  // constructor() {
  //   super();
  // }
}
SubComponent.descriptors = ['title', 'active'];

// 或者，在ES5中
function SubComponent() {
  Exact.Component.call(this); // 调用父类构造函数
}
SubComponent.prototype = Object.create(Exact.Component);
SubComponent.constructor = SubComponent;
SubComponent.descriptors = ['title', 'active'];</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// 在ES6中</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">SubComponent</span> <span class="cm-keyword">extends</span> <span class="cm-variable">Exact</span>.<span class="cm-property">Component</span> {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// 默认构造函数会调用父类构造函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// constructor() {</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">//   super();</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-comment">// }</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SubComponent</span>.<span class="cm-property">descriptors</span> <span class="cm-operator">=</span> [<span class="cm-string">'title'</span>, <span class="cm-string">'active'</span>];</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-comment">// 或者，在ES5中</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">function</span> <span class="cm-def">SubComponent</span>() {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-variable">Exact</span>.<span class="cm-property">Component</span>.<span class="cm-property">call</span>(<span class="cm-keyword">this</span>); <span class="cm-comment">// 调用父类构造函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SubComponent</span>.<span class="cm-property">prototype</span> <span class="cm-operator">=</span> <span class="cm-variable">Object</span>.<span class="cm-property">create</span>(<span class="cm-variable">Exact</span>.<span class="cm-property">Component</span>);</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SubComponent</span>.<span class="cm-property">constructor</span> <span class="cm-operator">=</span> <span class="cm-variable">SubComponent</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">SubComponent</span>.<span class="cm-property">descriptors</span> <span class="cm-operator">=</span> [<span class="cm-string">'title'</span>, <span class="cm-string">'active'</span>];</span></pre></div>
          </div>
        </div>
      </div>
    </div>
    <h4>Adding Validation</h4>
    <p>一些场景下，我们在为某个属性赋值之前，可能需要验证一下值的类型或其他因素。Exact中的Component和Store是支持验证机制的。
      为此，我们可以在`descriptors`的最后这样进行定义：</p>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
var CustomStore = Exact.defineClass({
  extend: Exact.Store,
  statics: {
    descriptors: ['a', 'b', {
      // 对于boolean、number、string类型
      title: 'string',
      amount: 'number',
      active: 'boolean',

      // 对于Object类型
      tool: Knife, // Knife是类的构造函数
      items: Array,

      // 以上是简单的类型验证，亦可允许多类型，模式匹配或自定义一个验证函数
      date: {
        type: ['number', 'string', Date]
      },
      name: {
        validator: /^[a-zA-Z0-9]{1,32}$/,
      },
      score: {
        type: 'number',
        validator: function(value) {
          if (value < 0 || value > 100) {
            return new Error('out of the range 0~100');
          }
        }
      }
    }]
  }
});</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">CustomStore</span> <span class="cm-operator">=</span> <span class="cm-variable">Exact</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">extend</span>: <span class="cm-variable">Exact</span>.<span class="cm-property">Store</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">descriptors</span>: [<span class="cm-string">'a'</span>, <span class="cm-string">'b'</span>, {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-comment">// 对于boolean、number、string类型</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">title</span>: <span class="cm-string">'string'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">amount</span>: <span class="cm-string">'number'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">active</span>: <span class="cm-string">'boolean'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-comment">// 对于Object类型</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">tool</span>: <span class="cm-variable">Knife</span>, <span class="cm-comment">// Knife是类的构造函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">items</span>: <span class="cm-variable">Array</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-comment">// 以上是简单的类型验证，亦可允许多类型，模式匹配或自定义一个验证函数</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">date</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">type</span>: [<span class="cm-string">'number'</span>, <span class="cm-string">'string'</span>, <span class="cm-variable">Date</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">name</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">validator</span>: <span class="cm-string-2">/^[a-zA-Z0-9]{1,32}$/</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">score</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">type</span>: <span class="cm-string">'number'</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">validator</span>: <span class="cm-keyword">function</span>(<span class="cm-def">value</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-keyword">if</span> (<span class="cm-variable-2">value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> <span class="cm-operator">||</span> <span class="cm-variable-2">value</span> <span class="cm-operator">&gt;</span> <span class="cm-number">100</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-keyword">return</span> <span class="cm-keyword">new</span> <span class="cm-variable">Error</span>(<span class="cm-string">'out of the range 0~100'</span>);</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    }]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre></div>
          </div>
        </div>
      </div>
    </div>
    <a id="custom-getter-setter"></a>
    <p>于是，`date`属性可接收的值包括123456、"2016/11/18"或者Date对象；`name`属性接收的值与模式不匹配时，不会将该值赋给`name`；`score`的数字范围需在区间[0,100]上。
      验证后会派发带有keyName的 `validated` 的事件，并附带参数error（为空时，表示验证通过）。</p>


    <h4>Custom Getter / Setter</h4>
    <p>Exact允许你在`descriptors`中自定义`get`或`set`方法，来拦截原有的取值、赋值的操作。
      你可以在自定义的`get`方法中覆盖默认的返回值，可以在自定义的`set`方法中追加一些行为，等等。</p>
    <div class="code-box scroll">
      <!--<pre class="code-behind js-mode">
var SubComponent = Exact.defineClass({
  extend: Exact.Component,
  statics: {
    descriptors: [{
      score: {
        type: 'number' // 此处声明不宜，在调用$set之前完成验证可能更好
        get: function() {
          return this.$get('score');
        },
        set: function(value) {
          // 强制裁剪
          value = value < 0 ? 0 : value;
          value = value > 100 ? 100 : value;

          this.$set('score', value); // 会触发验证、脏标记和更改通知
        }
      },
      time: {
        type: 'number', // 验证行为被覆盖，此处声明无效
        get: function() { return this._time; },
        set: function(value) { this._time = value; } // 单纯地赋值
      }
    }]
  }
});

var subComponent = new SubComponent();
subComponent.score = 120;        // 先强制裁剪，而后触发验证、脏标记和更改通知
console.log(subComponent.score); // 输出：100
subComponent.time = 1000;        // 不会触发验证、脏标记或更改通知
subComponent.set('time', 2000);  // 同样不会触发验证、脏标记或更改通知</pre>-->
      <div class="CodeMirror cm-s-alice">
        <div class="CodeMirror-lines">
          <div style="position: relative; outline: none;">
            <div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">SubComponent</span> <span class="cm-operator">=</span> <span class="cm-variable">Exact</span>.<span class="cm-property">defineClass</span>({</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">extend</span>: <span class="cm-variable">Exact</span>.<span class="cm-property">Component</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  <span class="cm-property">statics</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-property">descriptors</span>: [{</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">name</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">get</span>: <span class="cm-keyword">function</span>(<span class="cm-def">props</span>) {<span class="cm-tab" role="presentation" cm-text="	">  </span><span class="cm-comment">// 没有定义这样的get方法时，默认返回props.name</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-keyword">return</span> <span class="cm-string">'Marvin'</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      },</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      <span class="cm-property">score</span>: {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-property">type</span>: <span class="cm-string">'number'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">set</span>: <span class="cm-keyword">function</span>(<span class="cm-variable">value</span>, <span class="cm-variable">props</span>) {</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-comment">// 拦截并强制裁剪</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span> <span class="cm-operator">&lt;</span> <span class="cm-number">0</span> <span class="cm-operator">?</span> <span class="cm-number">0</span> : <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-variable">value</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span> <span class="cm-operator">&gt;</span> <span class="cm-number">100</span> <span class="cm-operator">?</span> <span class="cm-number">100</span> : <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">          <span class="cm-variable">props</span>.<span class="cm-variable">score</span> <span class="cm-operator">=</span> <span class="cm-variable">value</span>;</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">      }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    }]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">});</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text="">​</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">var</span> <span class="cm-def">subComponent</span> <span class="cm-operator">=</span> <span class="cm-keyword">new</span> <span class="cm-variable">SubComponent</span>();</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subComponent</span>.<span class="cm-property">name</span> <span class="cm-operator">=</span> <span class="cm-string">'Jack'</span>;   </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">subComponent</span>.<span class="cm-property">name</span>);  <span class="cm-comment">// 输出：'Marvin'</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">subComponent</span>.<span class="cm-property">score</span> <span class="cm-operator">=</span> <span class="cm-number">120</span>;        </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">console</span>.<span class="cm-property">log</span>(<span class="cm-variable">subComponent</span>.<span class="cm-property">score</span>); <span class="cm-comment">// 输出：100</span></span></pre></div>
          </div>
        </div>
      </div>
    </div>
    <p>另外，自定义`get`或`set`方法配合`depends`属性，可以将复杂的绑定逻辑隐藏于简单的属性访存器中，请参见<a></a>。</p>
    </article>
</div>

<!--<footer class="footer">
  <p>Released under the MIT license<br>
    © 2015 Chen Junyong. All rights reserved.</p>
</footer>-->

<!--<script src="../javascripts/codemirror.js"></script>-->
<!--<script src="../javascripts/javascript-mode.js"></script>-->
<!--<script src="../javascripts/code-format.js"></script>-->
<script src="../javascripts/site.js"></script>
</body>
</html>